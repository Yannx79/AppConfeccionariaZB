create database db_confeccionario;
use db_confeccinario;

/* ------------------------------- TABLAS SIN FKs ------------------------------- */
/* 1. Cargo */
create table cargo(
id_cargo int(11) auto_increment primary key not null,
descripcion varchar(100) null
); 

/* 2. Cliente */
create table cliente(
id_cliente int(11) auto_increment primary key not null,
nombres varchar(80) null,
ap_paterno varchar(20) null,
ap_materno varchar(20) null,
dni varchar(8) null,
telefono varchar(15) default null,
f_insercion date default null,
f_actualizacion date default null,
f_eliminacion date default null,
estado int(11) default 1
);

/* 3. Insumo */
create table insumo(
id_insumo int(11) auto_increment primary key NOT NULL,
nombre varchar(50) NULL,
descripcion varchar(100) DEFAULT NULL,
precio double NULL check (precio >= 0),
stock int(11) DEFAULT NULL CHECK (stock >= 0),
estado int(11) default 1,
f_insercion date DEFAULT NULL,
f_actualizacion date DEFAULT NULL,
f_eliminacion date DEFAULT NULL,
descuento double DEFAULT NULL
);

/* 4. Producto */
create table producto(
id_producto int(11) auto_increment primary key NOT NULL,
nombre varchar(50) NULL,
descripcion varchar(100) DEFAULT NULL,
precio double NULL check (precio >= 0),
stock int(11) DEFAULT NULL CHECK (stock >= 0),
estado int(11) default 1,
f_insercion date DEFAULT NULL,
f_actualizacion date DEFAULT NULL,
f_eliminacion date DEFAULT NULL,
descuento double DEFAULT NULL
);

/* 5. Proveedor */
create table proveedor(
id_proveedor int(11) auto_increment primary key NOT NULL,
nombres varchar(80) NULL,
ap_paterno varchar(20) NULL,
ap_materno varchar(20) NULL,
ruc varchar(11) NULL,
dni varchar(8) NULL,
telefono varchar(15) DEFAULT NULL,
f_insercion date DEFAULT NULL,
f_actualizacion date DEFAULT NULL,
f_eliminacion date DEFAULT NULL,
estado int(11) default 1
);

/* ------------------------------- TABLAS CON FK ------------------------------- */
/* 6. Usuario */
create table usuario(
id_usuario int(11) auto_increment primary key not NULL,
nombres varchar(80) NULL,
ap_paterno varchar(20) NULL,
ap_materno varchar(20) NULL,
usuario varchar(20) NULL,
pass varchar(200) NULL,
id_cargo int(11) not null,
foreign key (id_cargo) references cargo(id_cargo)
);

/* 7. Compra */
create table compra(
id_compra int(11) AUTO_INCREMENT PRIMARY KEY NOT NULL,
id_proveedor int(11) NOT NULL,
id_usuario int(11) NOT NULL,
total double DEFAULT NULL check (total >= 0),
fecha DATETIME DEFAULT NOW(),
impuesto double NOT NULL check (impuesto >= 0),
estado int null default 1,
foreign key (id_proveedor) references proveedor(id_proveedor),
foreign key (id_usuario) references usuario(id_usuario)
);

/* 8. Venta */
create table venta(
id_venta int(11) auto_increment primary key not NULL,
id_usuario int(11) NOT NULL,
id_cliente int(11) NOT NULL,
total double DEFAULT NULL check (total >= 0),
fecha datetime default now(),
impuesto double NOT NULL check (impuesto >=0),
estado int null default 1,
foreign key (id_usuario) references usuario(id_usuario),
foreign key (id_cliente) references cliente(id_cliente)
);

/* ------------------------------- TABLAS DETALLE ------------------------------- */
/* 9. Detalle compra */
create table detalle_compra(
id_insumo int(11) NOT NULL,
id_compra int(11) NOT NULL,
subtotal double NULL check (subtotal >= 0),
cantidad int(11) NULL check (cantidad >= 0),
estado int null default 1,
foreign key (id_insumo) references insumo(id_insumo),
foreign key (id_compra) references compra(id_compra),
primary key (id_insumo,id_compra)
);

/* 10. Detalle Venta */
create table detalle_venta(
id_producto int(11) NOT NULL,
id_venta int(11) NOT NULL,
subtotal double NULL check (subtotal >= 0),
cantidad int(11) NULL check (cantidad >= 0),
estado int null default 1,
foreign key (id_producto) references producto(id_producto),
foreign key (id_venta) references venta(id_venta),
primary key (id_producto,id_venta)
);

/**-------------------------------- INSERT CARGO ------------------------------**/
INSERT INTO `cargo`(`descripcion`) VALUES ('Vendedor'), ('Almacenero'), ('Administrador')

INSERT INTO `usuario`(`usuario`, `pass`, `id_cargo`) VALUES ('root', '63a9f0ea7bb98050796b649e85481845', 3), ('admin', '21232f297a57a5a743894a0e4a801fc3', 3)